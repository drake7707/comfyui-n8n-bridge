openapi: 3.1.0
info:
  title: ComfyUI n8n bridge
  version: 1.0.0
  description: API for uploading files, managing ComfyUI queue jobs, and deleting generated files.

servers:
  - url: http://localhost:{port}
    description: Local development server
    variables:
      port:
        default: "8190"

paths:

  /upload:
    put:
      summary: Upload a file to ComfyUI input directory
      description: |
        Uploads a file using multipart/form-data.  
        The file is stored in the directory configured by `COMFYUI_INPUT_PATH`.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        "200":
          description: File uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  filename:
                    type: string
                  message:
                    type: string
        "400":
          description: No files uploaded
        "500":
          description: File transfer error

  /upload/{filename}:
    delete:
      summary: Delete an uploaded file
      description: Deletes a file inside `COMFYUI_INPUT_PATH`.
      parameters:
        - in: path
          name: filename
          required: true
          schema:
            type: string
          description: Name of the file to delete
      responses:
        "200":
          description: Deletion success
        "400":
          description: Invalid filename (e.g., path traversal attempt)
        "404":
          description: File not found
        "500":
          description: File deletion error

  /download/{filename}:
    delete:
      summary: Delete an output or temp file
      description: Deletes a file inside ComfyUIâ€™s output or temp folders.
      parameters:
        - in: path
          name: filename
          required: true
          schema:
            type: string
        - in: query
          name: subfolder
          required: false
          schema:
            type: string
        - in: query
          name: filetype
          required: false
          schema:
            type: string
            enum: [temp, output]
      responses:
        "200":
          description: File deleted
        "400":
          description: Invalid filename
        "404":
          description: File not found
        "500":
          description: File deletion error

  /queue:
    post:
      summary: Queue a workflow for ComfyUI execution
      description: |
        Enqueues a workflow to the ComfyUI backend.  
        Immediately returns promptId + initial status.  
        After completion, the server sends a callback POST request to `callbackUrl`.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                workflow:
                  type: object
                  description: ComfyUI workflow JSON
                callbackUrl:
                  type: string
                  format: uri
      responses:
        "200":
          description: Initial queue response
          content:
            application/json:
              schema:
                type: object
                properties:
                  promptId:
                    type: string
                  status:
                    type: string
                  progress:
                    type: number
        "500":
          description: Execution error

  /status:
    get:
      summary: Get current ComfyUI connection status
      description: Returns status from the internal ComfyUI client.
      responses:
        "200":
          description: ComfyUI status object
          content:
            application/json:
              schema:
                type: object
        "500":
          description: Error retrieving status

components:
  schemas:
    OutputFile:
      type: object
      properties:
        filename:
          type: string
        subfolder:
          type: string
        filetype:
          type: string
          enum: [temp, output]
